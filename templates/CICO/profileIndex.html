{% extends "baseProfil.html" %} {% load static %} {% block content %}
<div class="text-center border rounded-0 shadow-sm mx-auto profile-box" style="
    width: 318px;
    height: 182px;
    background-color: #ffffff;
    margin: 5px;
    margin-top: 15px;
    margin-bottom: 15px;
  ">
    <div style="
      height: 50px;
      background-color: rgba(54, 162, 177, 0);
      background-image: url('{% static 'CICO/img/bg-pattern.png' %}');
    "></div>
    <span class="bs-icon-sm d-flex justify-content-center align-items-center ms-auto me-2 bs-icon"
        style="color: rgb(27, 52, 89)"><a href="#"><i class="fas fa-cog"
                style="color: var(--bs-body-color)"></i></a></span>
    <div class="my-auto">
        <img class="rounded-circle" src="{% static 'CICO/img/bg-cta.jpg' %}" width="60px" height="60px"
            style="background-color: rgb(255, 255, 255); padding: 2px" />
    </div>
    <div class="my-auto" style="height: 80px">
        <h4>{{user}}</h4>
        <p style="font-size: 12px">el {{user}}</p>
    </div>
</div>

</div>
<div>
    <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered">
            <thead>
                <tr>
                    <th>
                        <button class="btn d-flex my-auto justify-content-xl-start" type="button"
                            data-bs-target="#modal-1" data-bs-toggle="modal" style="width: 100%">
                            <i class="fas fa-plus fs-4" style="margin-right: 10px"></i>Ajouter
                            un nouveau chat
                        </button>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Cell 1</td>
                </tr>
                <tr>
                    <td>Cell 3</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" role="dialog" tabindex="-1" id="modal-1">
    <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header"><i class="fas fa-cat fs-1" style="margin-right: 10px;"></i>
                <h4 class="modal-title">Ajouter un nouveau chat</h4><button class="btn-close" type="button"
                    aria-label="Close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addCatForm">
                    <div class="container">
                        <div class="row flex-md-column flex-lg-column flex-xl-row">
                            <div class="col">
                                <div class="row row-cols-3">
                                    <div class="col-auto col-sm-auto col-md-auto col-lg-auto col-xl-auto col-xxl-auto align-self-center m-auto"
                                        style="margin: 15px;">
                                        <p class="text-center bg-body-secondary border rounded">Choisir une photo de
                                            face
                                        </p><img id="imgFrontPreview" class="border rounded d-flex m-auto" width="100%"
                                            height="200" src="{% static 'CICO/img/silhouette%20face.jpg' %}"><input
                                            id="imgFrontInput" type="file" style="margin-top: 15px;width: 100%;"
                                            required="" accept="image/*">
                                    </div>
                                    <div class="col-auto col-sm-auto col-md-auto m-auto" style="margin: 15px;">
                                        <p class="text-center bg-body-secondary border rounded"
                                            style="margin-top: 15px;">
                                            Choisir une photo de profil droit</p><img id="imgRightPreview"
                                            class="border rounded d-flex m-auto" width="200" height="200"
                                            src="{% static 'CICO/img/silhoutte%20profil%20droit.png' %}"><input
                                            id="imgRightInput" type="file" style="margin-top: 15px;width: 100%;"
                                            required="" accept="image/*">
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="row row-cols-3">
                                    <div class="col-auto col-sm-auto col-md-auto m-auto" style="margin: 15px;">
                                        <p class="text-center bg-body-secondary border rounded">Choisir une photo de
                                            derrière</p><img id="imgBackPreview" class="border rounded d-flex m-auto"
                                            width="180" height="200"
                                            src="{% static 'CICO/img/silhouette%20derrière.jpg' %}"><input
                                            id="imgBackInput" type="file" style="margin-top: 15px;width: 100%;"
                                            required="" accept="image/*">
                                    </div>
                                    <div class="col-auto col-sm-auto col-md-auto m-auto" style="margin: 15px;">
                                        <p class="text-center bg-body-secondary border rounded"
                                            style="margin-top: 15px;">
                                            Choisir une photo de profil gauche</p><img id="imgLeftPreview"
                                            class="border rounded d-flex m-auto" width="200" height="200"
                                            src="{% static 'CICO/img/silhoutte%20profil%20gauche.png' %}"><input
                                            id="imgLeftInput" type="file" style="margin-top: 15px;width: 100%;"
                                            required="" accept="image/*">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-auto align-self-xl-center align-self-xxl-center"><input
                                    class="border rounded-pill form-control-lg d-flex" type="text" name="catName"
                                    placeholder="Nom" style="width: 100%;margin-top: 15px;margin-bottom: 15px;"
                                    required="">
                            </div>
                        </div>
                    </div>
            </div>
            <div class="modal-footer"><button class="btn btn-light border rounded-pill" type="button"
                    data-bs-dismiss="modal">Annuler</button><button class="btn btn-primary border rounded-pill"
                    type="submit">Ajouter</button>
            </div>
            </form>

        </div>
    </div>
</div>

<script>
    function updateImagePreview(inputId, imageId) {
        document.getElementById(inputId).addEventListener('change', function (event) {
            const input = event.target;
            if (input.files && input.files[0]) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    document.getElementById(imageId).src = e.target.result;
                }

                reader.readAsDataURL(input.files[0]);
            }
        });
    }

    updateImagePreview('imgFrontInput', 'imgFrontPreview');
    updateImagePreview('imgBackInput', 'imgBackPreview');
    updateImagePreview('imgLeftInput', 'imgLeftPreview');
    updateImagePreview('imgRightInput', 'imgRightPreview');
</script>

<script>
    document.getElementById('catForm').addEventListener('submit', function (event) {
        event.preventDefault();  // Prevent the form from submitting the traditional way

        const formData = new FormData(this);

        fetch('/handle_form/', {  // Replace with your Django backend endpoint
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': getCookie('csrftoken')  // Make sure you have this function to get the CSRF token
            }
        })
            .then(response => response.json())
            .then(data => {
                // Handle the response data here
                // For example, update a table or display a message
                console.log(data);
            })
            .catch(error => console.error('Error:', error));
    });

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>

{% endblock %}